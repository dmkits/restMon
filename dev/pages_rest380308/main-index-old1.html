<!DOCTYPE html>
<html>
<head>
    <!--
        Customize this policy to fit your own app's needs. For more guidance, see:
            https://github.com/apache/cordova-plugin-whitelist/blob/master/README.md#content-security-policy
        Some notes:
            * gap: is required only on iOS (when using UIWebView) and is needed for JS->native communication
            * https://ssl.gstatic.com is required only on Android and is needed for TalkBack to function properly
            * Disables use of inline scripts in order to mitigate risk of XSS vulnerabilities. To change this:
                * Enable inline JS: add 'unsafe-inline' to default-src
    -->
    <!--<meta http-equiv="Content-Security-Policy" content="default-src 'self' data: 'unsafe-inline' gap: https://ssl.gstatic.com 'unsafe-inline'; style-src 'self' 'unsafe-inline'; media-src *; img-src 'self' data: content:;">-->
    <meta http-equiv="Content-Security-Policy" content="default-src * 'self' 'unsafe-inline' 'unsafe-eval' data: gap: content:">
    <meta charset=utf-8>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui, viewport-fit=cover">
    <!--<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">-->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#2196f3">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <link rel="shortcut icon" href="../imgm/cook-ico32.png">
    <script src="/jslib/framework7/js/framework7.min.js"></script>
    <link rel="stylesheet" href="/jslib/framework7/css/framework7.min.css">
    <link rel="stylesheet" type="text/css" href="/cssm/mobileIndex.css">
    <link rel="stylesheet" type="text/css" href="/cssm/mobileIcons.css">
    <link rel="stylesheet" type="text/css" href="/cssm/mobileApp.css">
    <script src="/jslib/moment/moment.js"></script>
    <title>GABIS Mobile</title>
</head>
<body>
<div id="app">
    <div class="appbar">
        <div class="appbar-inner">
            <div style="display:table;width:100%;min-height:25px;text-align:center">
                <span id="appbar-user" style="display:table-cell;font-size:18px;font-weight:bold"></span>
                <span id="appbar-modeMsg" style="display:table-cell;color:red;font-size:18px;font-weight:bold"></span>
            </div>
        </div>
    </div>
    <div class="view view-main" style="height:calc(100% - 25px)">
        <div class="page" data-name="home">

            <div class="panel panel-left panel-cover" id="main-panel-left">
                <div class="page">
                    <div class="page-content">
                        <div class="block">
                            <div class="list links-list">
                                <ul>
                                    <li>
                                        <a href="/home" class="panel-close" data-force="true" data-ignore-cache="true">Вход</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="block" id="main-panel-left-pages">
                            <div class="block-title">Страницы</div>
                            <div class="list links-list">
                                <ul>
                                    <li>
                                        <a href="/pageRestKitchenOrdersForCooking" class="panel-close" data-force="true" data-ignore-cache="true">Монитор заказов<br> на кухню</a>
                                    </li>
                                    <!--<li>-->
                                        <!--<a href="/pageListExcs" class="panel-close" data-force="true" data-ignore-cache="true">Перемещения товара</a>-->
                                    <!--</li>-->
                                </ul>
                            </div>
                            <div class="block-title">Настройки страниц</div>
                            <div class="list links-list">
                                <ul>
                                    <li>
                                        <a href="/pageRestKitchenOrdersForCookingSettings" class="panel-close">Монитор заказов<br> на кухню</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="block" id="main-panel-left-settings">
                            <div class="block-title">Справка</div>
                            <div class="list links-list">
                                <ul>
                                    <li>
                                        <a href="/pageHelpAbout" class="panel-close">О программе</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="navbar">
                <div class="navbar-inner">
                    <div class="left">
                        <a href="#" class="link icon-only panel-open" data-panel="left">
                            <i class="icon f7-icons">menu</i>
                        </a>
                    </div>
                </div>
            </div>

            <div class="page-content login-screen-content" id="mobileLogin-screen">
                <div id="mobileLogin-mainLogo" class="block main-logo"></div>
                <div id="mobileLogin-mainModeDebug" class="block" style="display:none;color:red;font-size:27px;font-weight:bold;text-align:center"></div>
                <!--<div class="login-screen-title">Авторизация</div>-->
                <div class="list no-hairlines-md" style="margin-bottom:0">
                    <ul>
                        <li class="item-content item-input">
                            <div class="item-inner">
                                <div class="item-title item-label">Имя пользователя</div>
                                <div class="item-input-wrap">
                                    <input id="mobileLogin-inputUsername" type="text" placeholder="Имя пользователя">
                                    <span class="input-clear-button"></span>
                                </div>
                            </div>
                        </li>
                        <li class="item-content item-input">
                            <div class="item-inner">
                                <div class="item-title item-label">Пароль</div>
                                <div class="item-input-wrap">
                                    <input id="mobileLogin-inputUPswrd" type="password" placeholder="Пароль">
                                    <span class="input-clear-button"></span>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="block" style="margin-top:0">
                    <div class="row list" style="margin-top:0;margin-bottom:0">
                        <div class="col" style="width:0px"></div>
                        <div class="col" style="width:auto;padding-right:0">
                            <label class="item-checkbox item-content" style="padding-left:0">
                                <input id="mobileLogin-checkboxStoreUser" type="checkbox" value=""/>
                                <i class="icon icon-checkbox"></i>
                                <div class="item-title">Запомнить меня</div>
                            </label>

                        </div>
                        <div class="col" style="width:0px"></div>
                    </div>
                    <div class="row">
                        <div class="col" style="width:0px"></div>
                        <button id="mobileLogin-btnLogin" class="col button button-fill button-round" style="width:200px">ВОЙТИ</button>
                        <div class="col" style="width:0px"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    var $$=Dom7,
            baseRoutes= [//-- App routes --
                { path: '/home', pageName: 'home', options:{clearPreviousHistory:true,ignoreCache:true} },
                { path: '/pageHelpAbout', componentUrl: '/mobile/pageHelpAbout'},
                { path: '(.*)', url: './mobile/actionError' }// Default route (404 page). MUST BE THE LAST
            ],
            app7= new Framework7({// Framework7 App main instance
                id:'io.framework7.mobile.gabis', version:"1.0.0",
                root: '#app', // app7 root element
                theme: 'ios', // 'auto' - Automatic theme detection, Can be md, ios or aurora
                routes: baseRoutes,
                workingDoc:null
            }),
            mainView= app7.views.create('.view-main',{domCache:true,stackPages:true});
    deviceBarcodeScannerReaderAction= function(){};//IT'S USED IN MOBILE APP
    $$('#main-panel-left-pages').hide();
    app7.initData=function(){
        app7.data={uuid:""};
        document.cookie="uuid=0";
        $$('#appbar-user').text("");$$('#appbar-modeMsg').text("");
        app7.data['recsListDocCount']=50;
        app7.data['excDeliveryListDocCount']=50;
        app7.data['excFromStockListDocCount']=50;
        app7.data['inventsListDocCount']=50;
        if(typeof(Storage)!=="undefined"){
            var recsListDocCount=localStorage.getItem("settings-recs-listDocCount");
            if(recsListDocCount&&!isNaN(parseInt(recsListDocCount)))app7.data['recsListDocCount']=parseInt(recsListDocCount);
            var excDeliveryListDocCount=localStorage.getItem("settings-excDelivery-listDocCount");
            if(excDeliveryListDocCount&&!isNaN(parseInt(excDeliveryListDocCount)))app7.data['excDeliveryListDocCount']=parseInt(excDeliveryListDocCount);
            var excFromStockListDocCount=localStorage.getItem("settings-excFromStock-listDocCount");
            if(excFromStockListDocCount&&!isNaN(parseInt(excFromStockListDocCount)))app7.data['excFromStockListDocCount']=parseInt(excFromStockListDocCount);
            var inventsListDocCount=localStorage.getItem("settings-inventory-listDocCount");
            if(inventsListDocCount&&!isNaN(parseInt(inventsListDocCount)))app7.data['inventsListDocCount']=parseInt(inventsListDocCount);
        }else{// Sorry! No Web Storage support..
        }
    };
    app7.setLoginStoredData=function(){
        $$('#mobileLogin-screen #mobileLogin-inputUPswrd').val("");
        $$('#mobileLogin-screen #mobileLogin-checkboxStoreUser').prop('checked',false);
        if(typeof(Storage)=="undefined"){
            $$('#mobileLogin-screen #mobileLogin-checkboxStoreUser').attr('disabled',1);
            return
        }
        $$('#mobileLogin-screen #mobileLogin-checkboxStoreUser').removeAttr('disabled');
        var username=localStorage.getItem("mobileLogin-username");
        if(!username||username.toString().trim()=="")return;
        $$('#mobileLogin-screen #mobileLogin-inputUsername').val(username);
        var storeLoginUserpswrdItemName="mobileLogin-upswrd-"+username,
                storeLoginUserpswrd=localStorage.getItem(storeLoginUserpswrdItemName);
        if(!storeLoginUserpswrd||storeLoginUserpswrd=="null")return;
        $$('#mobileLogin-screen #mobileLogin-inputUPswrd').val(storeLoginUserpswrd);
        $$('#mobileLogin-screen #mobileLogin-checkboxStoreUser').prop('checked',true);
    };
    app7.initData();
    app7.setLoginStoredData();
    $$('.view-main').on('page:afterin','.page[data-name="home"]',function(e){
        $$('#main-panel-left-pages').hide();
        app7.initData();
        app7.setLoginStoredData();
        app7.request.setup({ headers: {'uuid':app7.data.uuid} });
        $$('#mobileLogin-screen #mobileLogin-inputUsername').focus();
    });
    $$('#mobileLogin-screen #mobileLogin-btnLogin').on('click',function(){
        app7.loginProcess();
    });
    $$('#mobileLogin-screen #mobileLogin-inputUPswrd').on('keypress',function(e){
        if(e.keyCode==13||e.key=='Enter')app7.loginProcess();
    });
    app7.loginProcess=function(){
        var username = $$('#mobileLogin-screen #mobileLogin-inputUsername').val(),
                password = $$('#mobileLogin-screen #mobileLogin-inputUPswrd').val();
        app7.preloader.show();
        this.srvPostRequestJSON({url:'/login',data:{user:username,pswrd:password},errorDialogMsg:"Вход на сервер неудался!"},
                function(result,errmsg){
                    app7.preloader.hide();
                    $$('#mobileLogin-screen #mobileLogin-inputUPswrd').val("");
                    var appName=(result)?result.appName:"UNKNOWN", appVerSrv=(result)?result.appVerSrv:null,
                            appCVer=(result&&result.appCVer!=null)?result.appCVer:appVerSrv,
                            mode=(result)?result.mode:null,modeIsDebug=(result)?result.modeIsDebug:null;
                    app7.data["appName"]=appName; app7.data["appVerSrv"]=appVerSrv; app7.data["appCVer"]=appCVer;
                    app7.data["appMode"]=mode; app7.data["appModeMsg"]= "";
                    if(modeIsDebug){
                        $$('#mobileLogin-screen #mobileLogin-mainLogo').hide();
                        $$('#mobileLogin-screen #mobileLogin-mainModeDebug').show()
                                .html('ТЕСТОВЫЙ РЕЖИМ!!!'+((mode)?'<br><span style="font-size:18px">('+mode+')</span>':''));
                        app7.data["appModeMsg"]= "!ТЕСТОВЫЙ РЕЖИМ!";
                        $$('#appbar-modeMsg').text(app7.data["appModeMsg"]);
                    }else{
                        $$('#mobileLogin-screen #mobileLogin-mainLogo').show();
                        $$('#mobileLogin-screen #mobileLogin-mainModeDebug').hide();
                        $$('#appbar-modeMsg').text("");
                    }
                    app7.data["dbName"]= (result)?result.dbName:null;
                    app7.data["dbUserError"]= (result)?result.dbUserError:null;
                    app7.data["dbUserName"]= (result)?result.dbUserName:null;
                    $$('#appbar-user').text(app7.data["dbUserName"]);
                    app7.data["dbEmpRole"]= (result)?result.dbEmpRole:null;
                    if(!result||!result.uuid){
                        $$('#mobileLogin-screen #mobileLogin-inputUPswrd').focus(); return;
                    }
                    var sErrMsg=null;
                    if(!app7.version)sErrMsg= "Неизвестная версия приложения!";
                    else if(!app7.data.appVerSrv)sErrMsg= "Неизвестная версия сервера!";
                    else if(app7.version.toString().indexOf(appCVer.toString())!=0)sErrMsg= "Несовместимые версии  приложения и сервера!";
                    if(sErrMsg){
                        sErrMsg+= "<br>Работа с приложением невозможна!<br>Обратитесь к системному администратору.";
                        app7.dialog.alert(sErrMsg,"Внимание",function(){});
                        return;
                    }
                    $$('#mobileLogin-screen #mobileLogin-inputUsername').val("");
                    if(typeof(Storage)!=="undefined"){
                        localStorage.setItem("mobileLogin-username",username);
                        var storeLoginUserpswrdItemName="mobileLogin-upswrd-"+username;
                        if($$('#mobileLogin-screen #mobileLogin-checkboxStoreUser').prop('checked'))
                            localStorage.setItem(storeLoginUserpswrdItemName,password);
                        else
                            localStorage.setItem(storeLoginUserpswrdItemName,null);
                    }else{// Sorry! No Web Storage support..
                    }
                    app7.data.uuid=result.uuid;
                    app7.request.setup({ headers:{'uuid':result.uuid} });
                    app7.setUserRoutes();
                });
    };
    app7.setUserRoutes=function(){
        this.srvRequestJSON({url:'/mobile/getUserRoutes', errorDialogMsg:"Не удалось получить данные для загрузки!"},
                function(result,errmsg){
                    if(!result){ mainView.router.navigate('/home');return; }
                    mainView.router.routes=result;                                                         //console.log("userRoutes",result);
                    var userRoutes={}, definePath;
                    for(var i=0; i<result.length; i++){
                        var userRoutesItem=result[i];
                        userRoutes[userRoutesItem.path]=true;
                        if(!definePath&&userRoutesItem&&userRoutesItem.define) definePath=userRoutesItem.path;
                    }
                    var panelItems=$$("#main-panel-left-pages li a"),hasVisible=false;
                    for(var i=0; i<panelItems.length; i++){
                        var panelItem=panelItems[i], visible=userRoutes[panelItem.getAttribute("href")];
                        if(visible)$$(panelItem).show();else $$(panelItem).hide();
                        hasVisible=visible||hasVisible;
                    }
                    if(hasVisible)$$('#main-panel-left-pages').show();
                    if(!definePath)return;
                    mainView.router.navigate(definePath);
                });
    };

    /**
     * params = { method, url, data/conditions, showRequestErrorDialog, errorDialogMsg }
     * default: params.method="GET", params.showRequestErrorDialog = true
     * resultCallback = function(result, errorMessage)
     *  result = undefined if request failed
     *  result = null if response result is empty or response result error (parameter errorMessage exists)
     *  result = JSON response result if request success and response result is JSON
     *  errorMessage exists if request failed or response result contains error
     */
    app7.srvRequestJSON=function(params,callback){
        if(!params)return;
        if(!params.method)params.method="GET";
        var requestData={};
        if(params.data)requestData=params.data;
        else if(params.conditions&&typeof(params.conditions)=="string") requestData=params.conditions.replace('=','~');
        else if(params.conditions)
            for(var cName in params.conditions) requestData[cName.replace('=','~')]=params.conditions[cName];   //console.log('srvRequestJSON app7.request',params.url,'requestData=',requestData);
        this.request({method:params.method,url:params.url,data:requestData,
            headers:{ 'x-requested-with': 'application/json; charset=utf-8' },
            success:function(data){                                                                             //console.log('srvRequestJSON app7.request',params.url,'success data=',data);
                var errMsg;
                if(!params.errorDialogMsg)params.errorDialogMsg='Не удалось получить данные с сервера!';
                if(data==undefined||data==null) {
                    if(params.showRequestErrorDialog==false){ callback(null, null);return; }
                    errMsg=params.errorDialogMsg;
                }
                var jsonData;
                try{
                    jsonData=JSON.parse(data);
                }catch (e) {
                    errMsg=params.errorDialogMsg+'<br>Данные некорректные!';
                }
                if(jsonData&&jsonData.error){
                    if(typeof(jsonData.error)=="string")errMsg= jsonData.errorMessage||jsonData.error;
                    else errMsg= (jsonData.error.userMessage||jsonData.error.message||jsonData.error.error);
                    errMsg=params.errorDialogMsg+"<br>"+errMsg;
                }
                if(errMsg&&params.showRequestErrorDialog==false){ callback(null, errMsg);return; }
                if(errMsg&&app7.srvRequestJSONDialogErr){ app7.srvRequestJSONDialogErr.open(); return; }
                else if(errMsg){
                    app7.srvRequestJSONDialogErr = app7.dialog.alert(errMsg,"Внимание",function(){
                        app7.srvRequestJSONDialogErr = null;
                        callback(null, errMsg);
                    });
                    return;
                }                                                                                           //console.log('srvRequestJSON app7.request',params.url,'success jsonData=',jsonData);
                callback(jsonData);
            },
            error:function(xhr, status){                                                                    //console.log('srvRequestJSON app7.request',params.url,'error err=',xhr);
                var state=status,
                        msg=(!params.errorDialogMsg)?'Не удалось получить данные с сервера!':params.errorDialogMsg;
                if(params.showRequestErrorDialog==false){
                    callback(undefined,msg+"<br>Статус="+state);return;
                }
                if(state===0){
                    msg+="<br>Неправильный или недействительный адрес сервера"+
                            "<br>или доступ по указанному адресу сервера запрещен.";
                } else
                    msg+="<br>Не удалось установить связь с сервером по указанному адресу.";
                if(app7.srvRequestJSONDialogErr){
                    app7.srvRequestJSONDialogErr.open(); return;
                }
                app7.srvRequestJSONDialogErr=app7.dialog.alert(msg,"Внимание",function(){
                    app7.srvRequestJSONDialogErr=null;
                    callback(undefined,msg);
                });
            }
        });
    };
    /**
     * params = { url, data, showRequestErrorDialog, errorDialogMsg }
     * default: params.showRequestErrorDialog = true
     * resultCallback = function(result, errorMessage)
     *  result = undefined if request failed
     *  result = null if response result is empty or response result error (parameter errorMessage exists)
     *  result = JSON response result if request success and response result is JSON
     *  errorMessage exists if request failed or response result contains error
     */
    app7.srvPostRequestJSON=function(params,callback){
        if(!params)return;
        params.method="POST";
        if(!params.errorDialogMsg)params.errorDialogMsg="Не удалось получить результат операции с сервера!";
        this.srvRequestJSON(params,callback);
    };

    /** IT'S USED IN INNER PAGE TEMPLATES
     * dataTableHeader =
     * <table width="100%" style="position:fixed; top:104px; z-index: 100">
     *     <thead>
     *         <tr>
     *             <th width="40px">№<br>п/п</th>
     *             <th>Наименование товара<br>Штрихкод</th>
     *             <th width="50px">Ед.<br>изм.</th>
     *             <th width="50px">Уч.<br>кол-во</th>
     *             <th width="50px">Факт.<br>кол-во</th>
     *         </tr>
     *     </thead>
     *     <tbody style="display:none">
     *         <tr rowSelecting="true">
     *             <td rowSpan="2" width="40px" class="tdSrcPosID" dataItemName="TSrcPosID"></td>
     *             <td colSpan="4" class="tdProdName" dataItemName="ProdName"></td>
     *         </tr>
     *         <tr rowSelecting="true" onCreated="contentTableTROnCreated" onClick="contentTableTROnClick">
     *             <td dataItemName="Barcode"></td>
     *             <td width="50px" class="text-centered" dataItemName="UM"></td>
     *             <td width="50px" class="tdQty" dataItemName="TQty"><div class="table-text"></div></td> -- variant with inner div with data
     *             <td width="50px" class="tdNewQty" dataItemName="TNewQty"
     *                  onCreated="contentTableTDNewQtyOnCreated" onClick="contentTableTDNewQtyOnClick"></td>
     *         </tr>
     *     </tbody>
     * </table>
     *      tr rowSelecting - if row can be selected
     *      td dataItemName - name of data table row data item value
     *      tr,td onCreated - name of function called after td has been created,
     *          function(tr/td,tableDataItem,methods), methods={ rowSelectingMethod, <onClick function name if exists> }
     *      tr,td onClick - name of function called after td click,
     *          function(e,owner,dataTableItemName,self), e-onclick event, owner - owner of onClick action function, self-component instance
     * dataTableBody =
     * <table width="100%" style="margin-bottom: 43px;"></table>
     * totalTable =
     * <table width="100%" style="position:fixed; bottom:0px; z-index: 100">
     *     <tfoot>
     *         <tr>
     *             <td id="totalRows" width="40px">0</td>
     *             <td></td>
     *             <td id="totalQty" width="50px">0</td>
     *             <td id="totalNewQty" width="50px">0</td>
     *         </tr>
     *     </tfoot>
     * </table>
     * totalTable updated in innerPageUpdateTotalTable function
     * self = component instance
     * tableDataItem added to table TDs and table TD childs as [dataTableRowData]
     */
    app7.innerPageCreateTableRow= function(dataTableHeader, dataTableBody, tableDataItem, self){
        if(!dataTableHeader||!dataTableBody) return;
        var dataTableHeaderRows=$$(dataTableHeader).children("tbody").children("tr");
        if(!dataTableHeaderRows) return;
        if(!tableDataItem) tableDataItem={};
        var newTRs=[];
        for(var i=0; i<dataTableHeaderRows.length; i++){
            var dthTR=dataTableHeaderRows[i], newTR;
            newTRs.push(newTR=dthTR.cloneNode(true)); dataTableBody.appendChild(newTR);
            var rowSelecting= newTR.getAttribute("rowSelecting"),
                    tdOnClickFunction=function(e){
                        $$(dataTableBody).children('.tdSelectedRow').removeClass('tdSelectedRow');
                        for(var i=0; i<newTRs.length; i++) newTRs[i].classList.add('tdSelectedRow');
                    };
            var trOnCreatedMethodName= newTR.getAttribute("onCreated"),
                    trOnClickMethodName= newTR.getAttribute("onClick");
            if(trOnCreatedMethodName){
                var methods={};
                if(trOnClickMethodName)methods[trOnClickMethodName]= self[trOnClickMethodName];
                self[trOnCreatedMethodName](newTR,tableDataItem,methods);
            }
            if(trOnClickMethodName){
                var trOnClickMethod= self[trOnClickMethodName];
                newTR.onclick=function(e){
                    trOnClickMethod(e,newTR,tableDataItem,self);
                };
            }
            for(var j=0; j<newTR.children.length; j++){
                var newTD=newTR.children[j], dataTableItemName=newTD.getAttribute("dataItemName"), val;
                newTD.dataTableRowData=tableDataItem;
                if(newTD.firstChild)newTD.firstChild.dataTableRowData=tableDataItem;
                if(dataTableItemName!==undefined)val=tableDataItem[dataTableItemName];
                let newTDText=newTD.firstChild||newTD;
                newTDText.innerText=(val==undefined||val==null)?"":val.toString();
                var tdOnCreatedMethodName= newTD.getAttribute("onCreated"),
                        tdOnClickMethodName= newTD.getAttribute("onClick");
                if(tdOnCreatedMethodName){
                    var methods={};
                    if(rowSelecting)methods["rowSelectingMethod"]= tdOnClickFunction;
                    if(tdOnClickMethodName)methods[tdOnClickMethodName]= self[tdOnClickMethodName];
                    self[tdOnCreatedMethodName](newTD,tableDataItem,methods);
                }
                if(rowSelecting)newTD.onclick= tdOnClickFunction;
                if(tdOnClickMethodName){
                    var tdOnClickMethod= self[tdOnClickMethodName];
                    newTD.onclick=function(e){
                        tdOnClickFunction(e);
                        tdOnClickMethod(e,newTD,tableDataItem,self);
                    };
                }
            }
        }
    };
    /** IT'S USED IN INNER PAGE TEMPLATES
     * dataTableFoot =
     * <table width="100%" style="position:fixed; bottom:0px; z-index: 100">
     *     <tfoot>
     *         <tr>
     *             <td id="totalRows" width="40px">0</td>
     *             <td></td>
     *             <td id="totalQty" width="50px">0</td>
     *             <td id="totalNewQty" width="50px">0</td>
     *         </tr>
     *     </tfoot>
     * </table>
     * params = { <td id value>:<value>, .. }
     */
    app7.innerPageUpdateTotalTable=function(dataTableFoot, params){
        if(!params)return;
        var dataTableFootTR=$$(dataTableFoot).find("tr");
        for(var valueName in params) dataTableFootTR.find("td#"+valueName).html(params[valueName]);
    };
    /** IT'S USED IN INNER PAGE TEMPLATES
     * self = component instance
     * params = { dataTableHeader, dataTableBody, progressAction }
     *      progressAction = function(tableData,ind,tableDataItem), if no ind and no tableDataItem, do last progressAction
     * finishedCallback = function(tableData)
     */
    app7.innerPageFillTableData= function(self, tableData, params, finishedCallback){
        var progress = 0, progressStep=100/tableData.length;
        params.progressBarEl = app7.progressbar.show(progress, app7.theme === 'md' ? 'yellow' : 'blue');
        app7.preloader.show();$$(params.dataTableBody).hide();
        $$(params.dataTableBody).children("tr").remove();
        params.progressBarEl=params.progressBarEl; params.progress=progress; params.progressStep=progressStep;
        app7.fillInnerPageTableDataProgress(self, 0,tableData,params, function(){
            app7.progressbar.hide(params.progressBarEl);
            app7.preloader.hide();$$(params.dataTableBody).show();
            if(params.progressAction)params.progressAction(tableData);
            if(finishedCallback) setTimeout(function(){ finishedCallback(tableData); },1);
        });
    };
    /** IT'S USED IN INNER PAGE TEMPLATES
     * self = component instance
     * params = { dataTableHeader, dataTableBody, progressBarEl,progress,progressStep, progressAction }
     *      progressAction = function(tableData,ind,tableDataItem)
     * finishedCallback = function(tableData)
     */
    app7.fillInnerPageTableDataProgress= function(self, ind,tableData, params, finishedCallback){
        var timeout=10+Math.round(ind/100), i=ind, tableDataItem;
        while(i<ind+10){
            tableDataItem=tableData[i];
            if(!tableDataItem)break;
            app7.innerPageCreateTableRow(params.dataTableHeader,params.dataTableBody, tableDataItem, self);
            if(params.progressAction)params.progressAction(tableData, ind,tableDataItem);
            params.progress += params.progressStep;
            i++;
        }
        app7.progressbar.set(params.progressBarEl, params.progress);
        if(!tableDataItem){
            if(finishedCallback) setTimeout(function(){ finishedCallback(tableData); },timeout);
            return;
        }
        setTimeout(function(){
            app7.fillInnerPageTableDataProgress(self, i,tableData, params, finishedCallback)
        },timeout)
    };
</script>
</body>
</html>
